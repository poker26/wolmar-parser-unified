<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналитика подозрительных ставок - Wolmar Parser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-chart-line text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-2xl font-bold text-gray-900">Аналитика подозрительных ставок</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-home mr-2"></i>Главная
                    </a>
                    <a href="/admin" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-cog mr-2"></i>Админка
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Dashboard Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-gavel text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Всего ставок</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-bids">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-users text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Участников</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-bidders">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                        <i class="fas fa-hand-paper text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Ручных ставок</p>
                        <p class="text-2xl font-bold text-gray-900" id="manual-bids">-</p>
                        <p class="text-xs text-gray-500" id="manual-percentage">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-red-100 text-red-600">
                        <i class="fas fa-exclamation-triangle text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Подозрительных</p>
                        <p class="text-2xl font-bold text-gray-900" id="suspicious-users">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Tabs -->
        <div class="bg-white rounded-lg shadow-sm">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                    <button onclick="showTab('fast-bids')" id="tab-fast-bids" class="tab-button active border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-bolt mr-2"></i>Быстрые ставки
                    </button>
                    <button onclick="showTab('autobid-traps')" id="tab-autobid-traps" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-mouse-pointer mr-2"></i>Ловушки автобида
                    </button>
                    <button onclick="showTab('time-patterns')" id="tab-time-patterns" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-clock mr-2"></i>Временные паттерны
                    </button>
                    <button onclick="showTab('risk-scoring')" id="tab-risk-scoring" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Скоринг рисков
                    </button>
                </nav>
            </div>

            <!-- Fast Bids Tab Content -->
            <div id="content-fast-bids" class="tab-content p-6">
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Анализ быстрых ручных ставок</h3>
                    <p class="text-gray-600 mb-4">Поиск ручных ставок с подозрительно малыми интервалами времени</p>
                    <button onclick="loadFastBids(event)" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-search mr-2"></i>Загрузить анализ
                    </button>
                </div>
                
                <div id="fast-bids-results" class="hidden">
                    <div class="mb-4">
                        <span id="fast-bids-count" class="text-sm text-gray-600"></span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Участник</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Всего подозрительных</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Критических (< 1 сек)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Подозрительных (< 5 сек)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Быстрейший интервал</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Средний интервал</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Уровень риска</th>
                                </tr>
                            </thead>
                            <tbody id="fast-bids-table-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Autobid Traps Tab Content -->
            <div id="content-autobid-traps" class="tab-content p-6 hidden">
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Анализ ловушек автобида</h3>
                    <p class="text-gray-600 mb-4">Поиск лотов с подозрительной активностью, где победитель использовал автобид</p>
                    <button onclick="loadAutobidTraps(event)" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                        <i class="fas fa-search mr-2"></i>Загрузить анализ
                    </button>
                    <button onclick="updateSuspiciousScores(event)" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 ml-2">
                        <i class="fas fa-sync mr-2"></i>Обновить скоринг
                    </button>
                    <button onclick="loadSuspiciousUsers(event)" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 ml-2">
                        <i class="fas fa-users mr-2"></i>Подозрительные пользователи
                    </button>
                </div>
                
                <div id="autobid-traps-results" class="hidden">
                    <div class="mb-4">
                        <span id="autobid-traps-count" class="text-sm text-gray-600"></span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Аукцион/Лот</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Победитель</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Финальная цена</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Прогнозная цена</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Рост от прогноза</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ставок</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Участников</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Уровень риска</th>
                                </tr>
                            </thead>
                            <tbody id="autobid-traps-table-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div id="content-time-patterns" class="tab-content p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Временные паттерны</h3>
                <p class="text-gray-600">Функция в разработке...</p>
            </div>
            
            <div id="content-risk-scoring" class="tab-content p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Скоринг рисков</h3>
                <p class="text-gray-600">Функция в разработке...</p>
            </div>
        </div>
    </main>

    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'border-blue-500', 'text-blue-600');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab content
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            
            // Add active class to selected tab button
            const activeButton = document.getElementById(`tab-${tabName}`);
            activeButton.classList.add('active', 'border-blue-500', 'text-blue-600');
            activeButton.classList.remove('border-transparent', 'text-gray-500');
        }

        // Load dashboard stats
        async function loadStats() {
            try {
                const response = await fetch('/api/analytics/dashboard-stats');
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('total-bids').textContent = result.data.totalBids.toLocaleString();
                    document.getElementById('total-bidders').textContent = result.data.totalBidders.toLocaleString();
                    document.getElementById('manual-bids').textContent = result.data.manualBids.toLocaleString();
                    document.getElementById('manual-percentage').textContent = `${result.data.manualBidPercentage}% от всех ставок`;
                }
            } catch (error) {
                console.error('Ошибка загрузки статистики:', error);
            }
        }

        // Load fast manual bids analysis
        async function loadFastBids(event) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Загрузка...';
                button.disabled = true;

                const response = await fetch('/api/analytics/fast-manual-bids');
                const result = await response.json();
                
                if (result.success) {
                    displayFastBids(result.data);
                    document.getElementById('fast-bids-count').textContent = `Найдено ${result.data.length} подозрительных пользователей`;
                    document.getElementById('fast-bids-results').classList.remove('hidden');
                } else {
                    if (result.error === 'Анализ невозможен') {
                        alert(result.message);
                    } else {
                        alert('Ошибка загрузки данных: ' + result.error);
                    }
                }
            } catch (error) {
                console.error('Ошибка загрузки быстрых ставок:', error);
                alert('Ошибка загрузки данных');
            } finally {
                button.innerHTML = '<i class="fas fa-search mr-2"></i>Загрузить анализ';
                button.disabled = false;
            }
        }

        // Display fast bids results
        function displayFastBids(data) {
            const tbody = document.getElementById('fast-bids-table-body');
            tbody.innerHTML = '';

            data.forEach(user => {
                const row = document.createElement('tr');
                
                // Risk level styling
                let riskClass = 'text-gray-600';
                let riskIcon = '';
                if (user.risk_level === 'КРИТИЧЕСКИ ПОДОЗРИТЕЛЬНО') {
                    riskClass = 'text-red-600 font-semibold';
                    riskIcon = '<i class="fas fa-exclamation-triangle text-red-500 mr-1"></i>';
                } else if (user.risk_level === 'ПОДОЗРИТЕЛЬНО') {
                    riskClass = 'text-orange-600 font-medium';
                    riskIcon = '<i class="fas fa-exclamation-circle text-orange-500 mr-1"></i>';
                } else if (user.risk_level === 'ВНИМАНИЕ') {
                    riskClass = 'text-yellow-600';
                    riskIcon = '<i class="fas fa-info-circle text-yellow-500 mr-1"></i>';
                } else {
                    riskClass = 'text-green-600';
                    riskIcon = '<i class="fas fa-check-circle text-green-500 mr-1"></i>';
                }

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${user.bidder_login}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${user.suspicious_bids_count}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold text-red-600">${user.critical_count}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold text-orange-600">${user.suspicious_count}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-mono">${parseFloat(user.fastest_interval).toFixed(2)} сек</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <span class="font-mono">${user.avg_interval} сек</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${riskClass}">
                        ${riskIcon}${user.risk_level}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load autobid traps analysis
        async function loadAutobidTraps(event) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Загрузка...';
                button.disabled = true;

                const response = await fetch('/api/analytics/autobid-traps');
                const result = await response.json();
                
                if (result.success) {
                    displayAutobidTraps(result.data);
                    document.getElementById('autobid-traps-count').textContent = `Найдено ${result.data.length} подозрительных лотов`;
                    document.getElementById('autobid-traps-results').classList.remove('hidden');
                } else {
                    alert('Ошибка загрузки данных: ' + result.error);
                }
            } catch (error) {
                console.error('Ошибка загрузки ловушек автобида:', error);
                alert('Ошибка загрузки данных');
            } finally {
                button.innerHTML = '<i class="fas fa-search mr-2"></i>Загрузить анализ';
                button.disabled = false;
            }
        }

        // Display autobid traps results
        function displayAutobidTraps(data) {
            const tbody = document.getElementById('autobid-traps-table-body');
            tbody.innerHTML = '';

            data.forEach(lot => {
                const row = document.createElement('tr');
                
                // Risk level styling
                let riskClass = 'text-gray-600';
                let riskIcon = '';
                if (lot.risk_level === 'КРИТИЧЕСКИ ПОДОЗРИТЕЛЬНО') {
                    riskClass = 'text-red-600 font-semibold';
                    riskIcon = '<i class="fas fa-exclamation-triangle text-red-500 mr-1"></i>';
                } else if (lot.risk_level === 'ПОДОЗРИТЕЛЬНО') {
                    riskClass = 'text-orange-600 font-medium';
                    riskIcon = '<i class="fas fa-exclamation-circle text-orange-500 mr-1"></i>';
                } else if (lot.risk_level === 'ВНИМАНИЕ') {
                    riskClass = 'text-yellow-600';
                    riskIcon = '<i class="fas fa-info-circle text-yellow-500 mr-1"></i>';
                }

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${lot.auction_number}/${lot.lot_number}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${lot.winner_login}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${parseFloat(lot.winning_bid).toLocaleString()} ₽
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${lot.predicted_price ? parseFloat(lot.predicted_price).toLocaleString() + ' ₽' : 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-mono font-semibold ${lot.predicted_price_multiplier >= 2.0 ? 'text-red-600' : lot.predicted_price_multiplier >= 1.5 ? 'text-orange-600' : 'text-gray-600'}">
                            ${lot.predicted_price_multiplier ? lot.predicted_price_multiplier + 'x' : 'N/A'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${lot.total_bids}</span>
                        <div class="text-xs text-gray-500">
                            ${lot.manual_bid_count} ручных, ${lot.autobid_count} автобидов
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${lot.unique_bidders}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${riskClass}">
                        ${riskIcon}${lot.risk_level}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update suspicious scores
        async function updateSuspiciousScores(event) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Обновление...';
                button.disabled = true;

                const response = await fetch('/api/analytics/update-suspicious-scores', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    alert(`Скоринг обновлен успешно!\n\nСтатистика:\n- Всего пользователей: ${result.stats.total_users}\n- Подозрительных: ${result.stats.suspicious_users}\n- С быстрыми ставками: ${result.stats.fast_bids_users}\n- С ловушками автобида: ${result.stats.autobid_traps_users}\n- Средний скоринг: ${parseFloat(result.stats.avg_suspicious_score).toFixed(1)}\n- Максимальный скоринг: ${result.stats.max_suspicious_score}`);
                } else {
                    alert('Ошибка обновления скоринга: ' + result.error);
                }
            } catch (error) {
                console.error('Ошибка обновления скоринга:', error);
                alert('Ошибка обновления скоринга');
            } finally {
                button.innerHTML = '<i class="fas fa-sync mr-2"></i>Обновить скоринг';
                button.disabled = false;
            }
        }

        // Load suspicious users
        async function loadSuspiciousUsers(event) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Загрузка...';
                button.disabled = true;

                const threshold = prompt('Введите минимальный порог скоринга подозрительности (по умолчанию 30):', '30') || '30';
                const response = await fetch(`/api/analytics/suspicious-users?threshold=${threshold}`);
                const result = await response.json();
                
                if (result.success) {
                    displaySuspiciousUsers(result.data);
                    document.getElementById('autobid-traps-count').textContent = `Найдено ${result.data.length} подозрительных пользователей (порог: ${threshold})`;
                    document.getElementById('autobid-traps-results').classList.remove('hidden');
                } else {
                    alert('Ошибка загрузки данных: ' + result.error);
                }
            } catch (error) {
                console.error('Ошибка загрузки подозрительных пользователей:', error);
                alert('Ошибка загрузки данных');
            } finally {
                button.innerHTML = '<i class="fas fa-users mr-2"></i>Подозрительные пользователи';
                button.disabled = false;
            }
        }

        // Display suspicious users results
        function displaySuspiciousUsers(data) {
            const tbody = document.getElementById('autobid-traps-table-body');
            tbody.innerHTML = '';

            // Update table headers for suspicious users
            const thead = document.querySelector('#autobid-traps-results thead tr');
            thead.innerHTML = `
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Пользователь</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Общий скоринг</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Быстрые ставки</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ловушки автобида</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Манипуляции</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Рейтинг</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Потрачено</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Лотов</th>
            `;

            data.forEach(user => {
                const row = document.createElement('tr');
                
                // Suspicious score styling
                let scoreClass = 'text-gray-600';
                let scoreIcon = '';
                if (user.suspicious_score >= 80) {
                    scoreClass = 'text-red-600 font-bold';
                    scoreIcon = '<i class="fas fa-exclamation-triangle text-red-500 mr-1"></i>';
                } else if (user.suspicious_score >= 50) {
                    scoreClass = 'text-orange-600 font-semibold';
                    scoreIcon = '<i class="fas fa-exclamation-circle text-orange-500 mr-1"></i>';
                } else if (user.suspicious_score >= 30) {
                    scoreClass = 'text-yellow-600 font-medium';
                    scoreIcon = '<i class="fas fa-info-circle text-yellow-500 mr-1"></i>';
                }

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${user.winner_login}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${scoreClass}">
                        ${scoreIcon}${user.suspicious_score}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold ${user.fast_bids_score > 0 ? 'text-orange-600' : 'text-gray-400'}">${user.fast_bids_score || 0}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold ${user.autobid_traps_score > 0 ? 'text-red-600' : 'text-gray-400'}">${user.autobid_traps_score || 0}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold ${user.manipulation_score > 0 ? 'text-purple-600' : 'text-gray-400'}">${user.manipulation_score || 0}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${user.rating || 'N/A'}</span>
                        <div class="text-xs text-gray-500">${user.category || 'N/A'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${parseFloat(user.total_spent || 0).toLocaleString()} ₽</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <span class="font-semibold">${user.total_lots || 0}</span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize page
        loadStats();
    </script>
</body>
</html>
