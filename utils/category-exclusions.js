/**
 * Категории, для которых НЕЛЬЗЯ рассчитать прогнозную цену по аналогам
 * 
 * Эти категории исключаются из:
 * 1. Расчетов прогнозных цен (collection-price-service.js, improved-predictions-generator.js)
 * 2. Риск-отчетов, использующих прогнозную цену (analytics-service.js)
 * 
 * Причина: в этих категориях каждый предмет уникален, и нельзя найти аналогичные лоты
 * для корректного сравнения цен. Например, одно золотое кольцо нельзя сравнить с другим,
 * так как они отличаются дизайном, весом, наличием камней и т.д.
 */

const NON_PREDICTABLE_CATEGORIES = [
    // Ювелирные изделия и часы
    'Ювелирные изделия, часы',
    'Ювелирные изделия',
    'Часы',
    
    // Антиквариат
    'Антиквариат',
    
    // Искусство и предметы искусства
    'Картины, фарфор, бронза и пр.',
    'Картины',
    'Фарфор',
    'Бронза',
    
    // Религиозные предметы
    'Иконы',
    
    // Книги и документы
    'Книги',
    'Документы',
    
    // Награды (частично - некоторые награды уникальны)
    'Наградные ордена и медали иностранные',
    'Наградные ордена и медали России',
    'Награды, знаки, жетоны, копии',
    'Награды, знаки, жетоны',
    'Памятные медали',
    'Настольные медали',
    'Жетоны, знаки и др.',
    
    // Прочие уникальные предметы
    'Прочее',
    'Другое'
];

/**
 * Проверяет, можно ли рассчитать прогнозную цену для данной категории
 * 
 * ВАЖНО: Теперь для всех категорий разрешен расчет прогноза, но для исключенных категорий
 * требуется точное совпадение описания (см. requiresExactDescriptionMatch)
 * 
 * @param {string|null|undefined} category - Название категории
 * @returns {boolean} - true если можно рассчитать прогноз, false если нельзя
 */
function canCalculatePricePrediction(category) {
    // Теперь разрешаем расчет для всех категорий
    // Для исключенных категорий будет использоваться точное совпадение описания
    return true;
}

/**
 * Проверяет, требует ли категория точного совпадения описания для расчета прогноза
 * @param {string|null|undefined} category - Название категории
 * @returns {boolean} - true если требуется точное совпадение описания, false если можно искать аналоги
 */
function requiresExactDescriptionMatch(category) {
    if (!category) {
        return false;
    }
    
    const categoryLower = category.trim().toLowerCase();
    
    // Проверяем, есть ли категория в списке исключений
    for (const excludedCategory of NON_PREDICTABLE_CATEGORIES) {
        if (categoryLower === excludedCategory.toLowerCase()) {
            return true; // Для исключенных категорий требуется точное совпадение
        }
    }
    
    // Дополнительная проверка: если категория содержит ключевые слова
    const exclusionKeywords = [
        'ювелир',
        'антиквариат',
        'картин',
        'фарфор',
        'бронза',
        'икон',
        'книг',
        'наград',
        'медал',
        'жетон'
    ];
    
    for (const keyword of exclusionKeywords) {
        if (categoryLower.includes(keyword)) {
            return true; // Для таких категорий требуется точное совпадение
        }
    }
    
    return false; // Для обычных категорий можно искать аналоги
}

/**
 * Получает список категорий, для которых можно рассчитать прогнозную цену
 * @returns {Array<string>} - Список категорий
 */
function getPredictableCategories() {
    // Категории, для которых МОЖНО рассчитать прогнозную цену
    return [
        'Монеты',
        'Боны',
        'Боны России',
        'Боны иностранные',
        'Марки',
        'Марка',
        'Серебро',
        'Серебро и др. до 1800 года',
        'Серебро и др. с 1800 по 1945 год',
        'Серебро и др. после 1945 года',
        'Золото, платина и др. до 1945 года',
        'Золото, платина и др. после 1945 года'
    ];
}

module.exports = {
    NON_PREDICTABLE_CATEGORIES,
    canCalculatePricePrediction,
    requiresExactDescriptionMatch,
    getPredictableCategories
};

